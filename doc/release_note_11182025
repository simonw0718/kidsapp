## [2025-11-17] PWA & Cloudflare Pages Integration â€” Init + Deployment Ready

### ğŸ¯ å°ˆæ¡ˆé€²å…¥ PWA åŒ–èˆ‡æ­£å¼éƒ¨ç½²éšæ®µ

æœ¬æ¬¡æ›´æ–°å®Œæˆ Kid App çš„å®Œæ•´ PWA æ¶æ§‹ï¼Œä¸¦æˆåŠŸéƒ¨ç½²è‡³ Cloudflare Pagesï¼ˆhttps://kidsapp.pages.dev/ï¼‰ã€‚  
æ‰€æœ‰é…ç½®å‡ä¾ç…§ã€Œå…¨éœæ…‹ SPAã€èˆ‡ã€Œè·¨å¹³å° PWAã€çš„è¦æ±‚å®Œæˆï¼Œæ”¯æ´ iPad / Android çš„å®‰è£èˆ‡é›¢ç·šå•Ÿå‹•ã€‚

---

## ğŸ§± æŠ€è¡“åŸºåº•æ±ºç­–

- æ¡ç”¨ **Vite + React + TypeScript** ä½œç‚ºä¸»æ¡†æ¶ã€‚
- ä½¿ç”¨ **Cloudflare Pages** é€²è¡Œå…¨éœæ…‹è¨—ç®¡ï¼Œä¸¦å•Ÿç”¨è‡ªå‹•åŒ– CI/CDã€‚
- å…¨ç«™æ¡ç”¨ **SPA è·¯ç”±ï¼ˆreact-router-domï¼‰**ã€‚
- CSS çµ±ä¸€ç”± `layout.css` æ§åˆ¶å…¨ç«™è¦–è¦ºã€‚

---

## ğŸ“¦ æ–°å¢ / èª¿æ•´çš„ PWA ç›¸é—œæª”æ¡ˆ

### 1. `public/manifest.webmanifest`
- è¨­å®š App åç¨±ã€æè¿°ã€iconsã€start_urlã€‚
- å¼·åˆ¶æ©«å‘ `landscape`ï¼Œå„ªåŒ– iPad éŠæˆ²é«”é©—ã€‚
- è¨­å®š PWA display æ¨¡å¼ç‚º `standalone`ã€‚

### 2. `public/sw.js`
- å»ºç«‹ **cache-first service worker**ã€‚
- æ”¯æ´ï¼š  
  - é¦–æ¬¡å®‰è£å¿«å–  
  - App é›¢ç·šå•Ÿå‹•  
  - åŸºç¤ fetch fallback  
- Cloudflare Pages éƒ¨ç½²å¾Œ scope æ­£ç¢ºè¨­æ–¼ `/`ã€‚

### 3. `public/icons/`
- æ–°å¢ 192x192 / 512x512 iconï¼ˆä½¿ç”¨æ–°è§’è‰²åœ–ï¼‰ã€‚

---

## ğŸ”§ App å±¤ç´šå¯¦ä½œ

### 1. Service Worker è¨»å†Šï¼ˆ`src/main.tsx`ï¼‰
- App åœ¨ load å¾Œæœƒè‡ªå‹•è¨»å†Š `sw.js`ã€‚
- æ”¯æ´æ›´æ–°æ™‚è‡ªå‹•å•Ÿå‹•æ–°ç‰ˆ service workerã€‚

### 2. PageContainer å»ºç½®å®Œæˆ
- çµ±ä¸€æ‰€æœ‰é é¢çš„ Header / Content Layoutã€‚

### 3. `layout.css` å®Œæ•´æ•´åˆ
- æ¢å¾© AbacusPlayPage æ‰€æœ‰ `.abacus-*` æ¨£å¼ã€‚
- ç§»é™¤ Vite scaffold åŸå§‹æ¨£å¼å¹²æ“¾ã€‚

---

## ğŸ› ï¸ è·¯ç”±èˆ‡é é¢ä¸²æ¥å®Œæˆ

- `/` â†’ Home ä¸»é¸å–®ã€‚
- `/abacus` â†’ å°å°ç®—ç åŠ æ¸›æ¨‚å…¥å£é ã€‚
- `/games/abacus/play` â†’ ç®—ç›¤éŠæˆ²é ï¼ˆAbacusPlayPageï¼‰ã€‚
- `/picture-match` â†’ åœ–åƒå­—å¡å…¥å£é ï¼ˆPictureMatchEntryPageï¼‰ã€‚

æ–°å¢ feature-level å‡ºå£ï¼š

- `src/features/abacus/index.ts`
- `src/features/pictureMatch/index.ts`

---

## ğŸ“Œ UI èˆ‡ Layout ç›¸é—œä¿®å¾©

- ä¿®æ­£ `.abacus-play-layout` æ¨£å¼éºå¤± â†’ åŸå› ç‚º layout.css æœªè¢« main.tsx å¼•å…¥ã€‚
- é‡å»ºå…¨ç«™ resetï¼Œä½¿æ‰€æœ‰éŠæˆ²æ’ç‰ˆä¸€è‡´ã€‚
- ç¢ºä¿æ‰€æœ‰å…ƒä»¶æ”¯æ´ iPad å¯¬è¢å¹•ã€‚

---

# ğŸš€ PWA â€” å®‰è£é«”é©—å„ªåŒ–ï¼ˆNewï¼‰

### âœ” æ–°å¢ `usePwaInstallPrompt`ï¼ˆ`src/core/pwa/usePwaInstallPrompt.ts`ï¼‰
- ç›£è½ `beforeinstallprompt` äº‹ä»¶ã€‚
- æä¾› `isInstallable / isInstalled / promptInstall()` ä¸‰å¤§ç‹€æ…‹ã€‚
- ç›£è½ `appinstalled` è‡ªå‹•éš±è— bannerã€‚

### âœ” HomePage æ–°å¢å®‰è£æç¤º Banner
- Android / Chrome â†’ æä¾›ã€Œå®‰è£åˆ°é€™å°è£ç½®ã€æŒ‰éˆ•ã€‚
- iOSï¼ˆSafariï¼‰â†’ é¡¯ç¤ºã€Œåˆ†äº« â†’ åŠ å…¥ä¸»ç•«é¢ã€å®‰è£æ•™å­¸ã€‚
- ä½¿ç”¨è€…é—œé–‰ Banner æœ¬æ¬¡ session å³ä¸å†é¡¯ç¤ºã€‚

---

# ğŸŒ Cloudflare Pages â€” éƒ¨ç½²æ­£å¼å®Œæˆï¼ˆkidsapp.pages.devï¼‰

### âœ” Build è¨­å®š
- Build commandï¼š`npm run build`
- Outputï¼š`dist`
- Node Versionï¼š20.x
- Framework presetï¼šNoneï¼ˆVite å®˜æ–¹å»ºè­°ï¼‰

### âœ” ä¸Šç·šå¾Œæª¢æŸ¥çµæœ
- manifest æ­£å¸¸è¼‰å…¥ï¼š`/manifest.webmanifest`
- SW æˆåŠŸè¨»å†Šï¼š`/sw.js`
- icons æ­£å¸¸é¡¯ç¤º
- æ‰€æœ‰è·¯ç”±æ”¯æ´ Cloudflare SPA fallbackï¼š
  - `/`
  - `/abacus`
  - `/games/abacus/play`
  - `/picture-match`

---

# ğŸ” iPad / PWA å®‰è£æª¢æŸ¥

### âœ” Safari é–‹å•Ÿé¦–é æ™‚
- é¡¯ç¤º iOS ç‰ˆå®‰è£æ•™å­¸ Bannerï¼ˆå·²é©—è­‰ï¼‰ã€‚

### âœ” ã€ŒåŠ å…¥ä¸»ç•«é¢ã€å¾Œ
- æ­£ç¢ºé¡¯ç¤ºè‡ªè¨‚ App Iconã€‚
- å•Ÿå‹•å¾Œä¸å†é¡¯ç¤º Safari UIï¼ˆstandalone æ¨¡å¼ï¼‰ã€‚
- å¯é›¢ç·šå•Ÿå‹•é¦–é ï¼ˆç¬¦åˆ PWA è¦æ±‚ï¼‰ã€‚
- é€²å…¥æ‰€æœ‰è·¯ç”±ä¸æœƒè·³ 404ï¼ˆSPA fallback æ­£å¸¸ï¼‰ã€‚

---

æœ¬æ¬¡æ›´æ–°ä»£è¡¨ Kid App å·²å¾é–‹ç™¼éšæ®µé€²å…¥ã€Œ**æ­£å¼å¯å®‰è£ / å¯é›¢ç·š / å¯éƒ¨ç½²**ã€çš„å®Œæ•´ç”¢å“æ¨¡å¼ã€‚