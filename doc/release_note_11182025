## [2025-11-17] PWA & Cloudflare Pages Integration â€” Init

### ğŸ¯ å°ˆæ¡ˆé€²å…¥ PWA åŒ–èˆ‡æ­£å¼éƒ¨ç½²è¦åŠƒ

æœ¬æ¬¡æ›´æ–°å»ºç«‹äº†æ•´å€‹ Kid App çš„ PWA åŸºç¤æ¶æ§‹ï¼Œä¸¦æŒ‡å®šä½¿ç”¨ Cloudflare Pages åšå…¨éœæ…‹è¨—ç®¡ã€‚æ‰€æœ‰è¨­å®šçš†éµå¾ªã€Œå–®ä¸€å‰ç«¯éœæ…‹ SPAã€èˆ‡ã€Œæœ¬æ©Ÿç´€éŒ„ã€è¦ç¯„ï¼Œä¸¦å®Œæ•´æ”¯æ´ iPad / iOS çš„ä¸»ç•«é¢å®‰è£èˆ‡ç¨ç«‹ App é«”é©—ã€‚

---

### ğŸ§± æŠ€è¡“åŸºåº•æ±ºç­–
- ä½¿ç”¨ Vite + React + TypeScript ä½œç‚ºå°ˆæ¡ˆä¸»æ¶æ§‹ã€‚
- ä»¥ Cloudflare Pages ä½œç‚ºæœ€çµ‚éƒ¨ç½²å¹³å°ã€‚
- æ¡ç”¨ SPAï¼ˆå–®é å¼æ‡‰ç”¨ç¨‹å¼ï¼‰è¨­è¨ˆï¼Œæ”¯æ´æœªä¾†å¤šéŠæˆ²æ¨¡çµ„åˆ‡æ›ã€‚

---

### ğŸ“¦ æ–°å¢ PWA æ–‡ä»¶èˆ‡è¨­å®š
- `/public/manifest.webmanifest`  
  - è¨­å®š App åç¨±ã€iconsã€å•Ÿå‹•æ¨¡å¼ã€æ©«å‘é¡¯ç¤ºç­‰ã€‚
- `/public/sw.js`  
  - å»ºç«‹ cache-first service workerï¼Œæ”¯æ´é›¢ç·šä½¿ç”¨ã€‚
  - ä¿®æ­£ Safari å° redirect response çš„åš´æ ¼é™åˆ¶ã€‚
- `/public/icons/`  
  - æ–°å¢ PWA æ‰€éœ€ icon å°ºå¯¸ï¼ˆ192 / 512ï¼‰ã€‚

---

### ğŸ”§ App å…¥å£èˆ‡ Service Worker è¨»å†Š
- åœ¨ `src/main.tsx` åŠ å…¥ service worker è‡ªå‹•è¨»å†Šé‚è¼¯ã€‚
- çµ±ä¸€ç”± `layout.css` æ§åˆ¶å…¨ç«™åŸºç¤æ¨£å¼ã€‚

---

### ğŸŒ Cloudflare Pages éƒ¨ç½²è¦ç¯„
- Build æŒ‡ä»¤ï¼š`npm run build`
- Outputï¼š`dist`
- SPA Fallbackï¼šä½¿ç”¨ Cloudflare Pages é è¨­ fallbackï¼ˆç„¡éœ€é¡å¤–è¨­å®šï¼‰
- å·²æˆåŠŸéƒ¨ç½²æ–¼ï¼šhttps://kidsapp.pages.dev/

---

## ğŸ§­ è·¯ç”±èˆ‡å…¥å£é å»ºç½®

- å®‰è£ä¸¦å°å…¥ `react-router-dom`ï¼Œå»ºç«‹ SPA è·¯ç”±æ¶æ§‹ã€‚
- å»ºç«‹ä¸»è·¯ç”± `AppRouter` èˆ‡ä¸‰å€‹é é¢ï¼š
  - `/`ï¼šHomePageï¼ˆéŠæˆ²é¸å–®ï¼‰
  - `/abacus`ï¼šå°å°ç®—ç åŠ æ¸›æ¨‚å…¥å£é 
  - `/picture-match`ï¼šåœ–åƒå­—å¡é…å°å…¥å£é 
- å»ºç«‹ `GameCard` ä½œç‚ºå…¥å£é å¡ç‰‡å…ƒä»¶ã€‚
- æ–°å¢ feature å‡ºå£ï¼š
  - `src/features/abacus/index.ts`
  - `src/features/pictureMatch/index.ts`
- Abacus å…©éšæ®µé é¢ï¼ˆå…¥å£ï¼‹ç©æ³•ï¼‰å‡å·²ä¸²æ¥å®Œæˆã€‚

---

## ğŸ› ï¸ Abacus Layout ä¿®å¾©

- ä¿®æ­£ `.abacus-*` æ¨£å¼éºå¤±å•é¡Œï¼ˆæ ¹å› ï¼šlayout.css æœªæ–¼ main.tsx è¼‰å…¥ï¼‰ã€‚
- å·²æ–¼ `src/main.tsx` å¼•å…¥ `core/layout/layout.css`ï¼Œæ¢å¾©å®Œæ•´éŠæˆ²æ’ç‰ˆã€‚
- ç§»é™¤ Vite é è¨­æ¨£å¼ï¼Œæ”¹å…¨ç«™ä½¿ç”¨è‡ªå®¶ layoutã€‚

---

## ğŸš€ PWA ä¸»åŠŸèƒ½å®Œæˆ

### âœ” Service Workerï¼ˆsw.jsï¼‰
- æ¡ç”¨ cache-first ç­–ç•¥å¿«å–æ ¸å¿ƒéœæ…‹è³‡æºï¼š
  - `index.html`
  - manifest
  - icons
- ä¿®æ­£ Safari å°è‡´ç™½ç•«é¢çš„æ ¹æœ¬å•é¡Œï¼š
  - ä¸å†æ””æˆª `navigation` è«‹æ±‚ã€‚
  - é¿å…å°‡ redirect response å›å‚³çµ¦ iOSã€‚
  - å·²æœçµ• `Response served by service worker has redirections`ã€‚

### âœ” Main App Lifecycle
- Service Worker æ–¼ load æ™‚è‡ªå‹•è¨»å†Šã€‚
- layout èˆ‡ feature CSS æ–¼å…¥å£çµ±ä¸€è¼‰å…¥ã€‚

### âœ” Manifest
- PWA icon å·²æ›´æ›ç‚ºæ–°è§’è‰²åœ–ï¼ˆ192 / 512ï¼‰ã€‚
- å¼·åˆ¶æ©«å‘ï¼ˆlandscapeï¼‰æ¨¡å¼ï¼Œå„ªåŒ– iPad ä½¿ç”¨æƒ…å¢ƒã€‚

---

## ğŸ iOS / iPadOS PWA é«”é©—å„ªåŒ–ï¼ˆæœ€çµ‚ä¿®æ­£ï¼‰

### å·²å®Œæˆçš„æ”¹å–„é …ç›®ï¼š

- æ–°å¢ iOS å¿…è¦è¨­å®šï¼š
  - `apple-touch-icon`
  - `apple-mobile-web-app-capable`
  - `apple-mobile-web-app-status-bar-style`
  - `apple-mobile-web-app-title`
- ä¿®æ­£å•é¡Œï¼š
  - åŠ å…¥ä¸»ç•«é¢å¾Œ icon ä¸é¡¯ç¤ºã€‚
  - App ä»¥ Safari æ¨¡å¼é–‹å•Ÿï¼ˆé standaloneï¼‰ã€‚
  - é»é–‹å¾Œç™½ç•«é¢ + SW redirect éŒ¯èª¤ã€‚
- ç¾åœ¨ iPad ä¸Šå¯æ­£å¸¸ï¼š
  - åŠ å…¥ä¸»ç•«é¢ã€‚
  - ä»¥ç¨ç«‹ App å…¨è¢å¹•é¡¯ç¤ºã€‚
  - è‡ªå‹•å¿«å–æ ¸å¿ƒè³‡æºä¾›é›¢ç·šå•Ÿå‹•ã€‚
  - ç©©å®šé–‹å•Ÿèˆ‡ä½¿ç”¨ï¼ˆå¯¦æ¸¬é€šéï¼‰ã€‚

---

æœ¬æ¬¡æ›´æ–°ä»£è¡¨ PWA æ¶æ§‹å·²æˆåŠŸè½åœ°ï¼ŒKid App å·²å…·å‚™ã€Œå¯å®‰è£ã€å¯é›¢ç·šã€å¯è·¨å¹³å°éƒ¨ç½²ã€çš„å®Œæ•´å½¢æ…‹ï¼Œå¾ŒçºŒå¯æ­£å¼é€²å…¥éŠæˆ²æ¨¡çµ„é–‹ç™¼èˆ‡ QA éšæ®µã€‚