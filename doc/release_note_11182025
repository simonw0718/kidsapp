## [2025-11-17] PWA & Cloudflare Pages Integration â€” Init

### ğŸ¯ å°ˆæ¡ˆé€²å…¥ PWA åŒ–èˆ‡æ­£å¼éƒ¨ç½²è¦åŠƒ

æœ¬æ¬¡æ›´æ–°å»ºç«‹äº†æ•´å€‹ Kid App çš„ PWA åŸºç¤æ¶æ§‹ï¼Œä¸¦æŒ‡å®šä½¿ç”¨ Cloudflare Pages åšå…¨éœæ…‹è¨—ç®¡ã€‚æ‰€æœ‰è¨­å®šçš†éµå¾ªã€Œå–®ä¸€å‰ç«¯éœæ…‹ SPAã€èˆ‡ã€Œæœ¬æ©Ÿç´€éŒ„ã€è¦ç¯„ã€‚

### ğŸ§± æŠ€è¡“åŸºåº•æ±ºç­–
- ä½¿ç”¨ Vite + React + TypeScript ä½œç‚ºå°ˆæ¡ˆä¸»æ¶æ§‹ã€‚
- ä»¥ Cloudflare Pages ä½œç‚ºæœ€çµ‚éƒ¨ç½²å¹³å°ã€‚
- æ¡ç”¨ SPAï¼ˆå–®é å¼æ‡‰ç”¨ç¨‹å¼ï¼‰è¨­è¨ˆï¼Œæ”¯æ´æœªä¾†å¤šéŠæˆ²æ¨¡çµ„åˆ‡æ›ã€‚

### ğŸ“¦ æ–°å¢ PWA æ–‡ä»¶èˆ‡è¨­å®š
- `/public/manifest.webmanifest`  
  - è¨­å®š App åç¨±ã€iconsã€å•Ÿå‹•æ¨¡å¼ã€æ©«å‘é¡¯ç¤ºç­‰ã€‚
- `/public/sw.js`  
  - å»ºç«‹ cache-first service workerï¼Œæ”¯æ´é›¢ç·šä½¿ç”¨ã€‚
- `/public/icons/`  
  - æ–°å¢ PWA æ‰€éœ€ icon å°ºå¯¸ï¼ˆ192 / 512ï¼‰ã€‚

### ğŸ”§ App å…¥å£èˆ‡ Service Worker è¨»å†Š
- åœ¨ `src/main.tsx` åŠ å…¥ service worker è‡ªå‹•è¨»å†Šé‚è¼¯ã€‚

### ğŸŒ Cloudflare Pages éƒ¨ç½²è¦ç¯„
- Build æŒ‡ä»¤ï¼š`npm run build`
- Outputï¼š`dist`
- SPA Fallbackï¼šè‡ªå‹•æ”¯æ´

æœ¬æ¬¡æ›´æ–°ç‚ºå¾ŒçºŒéŠæˆ²æ¨¡çµ„ï¼ˆç®—ç›¤ã€åœ–åƒå­—å¡ã€æƒ…ç·’åŠ‡å ´ç­‰ï¼‰æä¾›å®Œæ•´çš„ PWA èˆ‡éƒ¨ç½²åŸºç¤ã€‚

---

### è·¯ç”±èˆ‡å…¥å£é å»ºç½®

- å®‰è£ä¸¦å°å…¥ `react-router-dom`ï¼Œå»ºç«‹ SPA è·¯ç”±æ¶æ§‹ã€‚
- æ–°å¢ `AppRouter` èˆ‡ä¸‰å€‹é é¢ï¼š
  - `/`ï¼šä¸»å…¥å£ HomePageï¼ˆéŠæˆ²é¸å–®ï¼‰
  - `/abacus`ï¼šå°å°ç®—ç åŠ æ¸›æ¨‚é é¢ï¼ˆå¾…æ›å…¥å¯¦éš›æ¨¡çµ„ï¼‰
  - `/picture-match`ï¼šåœ–åƒå­—å¡é…å°é é¢ï¼ˆå¾…æ›å…¥å¯¦éš›æ¨¡çµ„ï¼‰
- æ–°å¢ `GameCard` å…ƒä»¶ä½œç‚ºå…¥å£é éŠæˆ²å¡ç‰‡ã€‚
- æ›´æ–° PWA iconï¼Œæ”¹ç”¨æ–°è§’è‰²åœ–è£½ä½œ 192x192 / 512x512 iconsã€‚

### ğŸ› ï¸ è·¯ç”±ä¸²æ¥å®Œæˆ & Layout ä¿®å¾©ï¼ˆAbacus æ¨¡çµ„ï¼‰

- å®Œæˆ `/abacus` èˆ‡ `/games/abacus/play` çš„å®Œæ•´ä¸²æ¥ï¼Œå…¥å£é èˆ‡ç©æ³•é é€£å‹•æ­£å¸¸ã€‚
- ä¿ç•™åŸæœ¬ Abacus æ¨¡çµ„çš„å…©å±¤é é¢æ¶æ§‹ï¼š
  - `AbacusEntryPage`ï¼šä¸»å…¥å£é 
  - `AbacusPlayPage`ï¼šéŠæˆ²æ“ä½œé 
- æ–°å¢ feature-level å‡ºå£ï¼š
  - `src/features/abacus/index.ts`
  - `src/features/pictureMatch/index.ts`
- ä¿®æ­£ AbacusPlayPage æ’ç‰ˆç•°å¸¸å•é¡Œï¼š
  - åŸå› ç‚º layout.css æœªè¢«è¼‰å…¥å°è‡´æ‰€æœ‰ `.abacus-*` æ¨£å¼éºå¤±ã€‚
  - å·²æ–¼ `src/main.tsx` æ­£å¼å¼•å…¥ `./core/layout/layout.css`ï¼Œä¸¦æ¢å¾©å®Œæ•´ç‰ˆé¢ã€‚
- ç§»é™¤ Vite scaffold é è¨­æ¨£å¼å¹²æ“¾ï¼Œçµ±ä¸€ç”± layout.css æ§ç‰ˆã€‚

### ğŸ“Œ Home å…¥å£é ä¸²æ¥å®Œæˆ

- HomePage å·²å¯æ­£å¸¸å¼•å°è‡³ï¼š
  - `/abacus`
  - `/picture-match`
- æ‰€æœ‰å­é é¢çš†å¯é€é SPA Router æ­£å¸¸åˆ‡æ›ã€‚

---

## ğŸš€ PWA å¯¦ä½œé€²å…¥ä¸»éšæ®µ

### âœ” Service Workerï¼ˆsw.jsï¼‰
- å»ºç«‹ cache-first æ¶æ§‹ï¼Œæ”¯æ´é›¢ç·šå•Ÿå‹•æ ¸å¿ƒéœæ…‹è³‡æºã€‚
- å®‰è£éšæ®µå¿«å–å›ºå®šè³‡æºï¼ˆ`index.html`ã€manifestã€iconsï¼‰ã€‚
- Safari å°èˆªè«‹æ±‚ä¸å†ç”± service worker æ””æˆªï¼Œé¿å… `Response served by service worker has redirections` å•é¡Œã€‚

### âœ” Main App Lifecycle
- åœ¨ `src/main.tsx` å®Œæˆå…¨ç«™ SW è‡ªå‹•è¨»å†Šã€‚
- ç¢ºä¿æ‰€æœ‰ layout èˆ‡ feature-level CSS æ–¼æœ€ä¸Šå±¤è¼‰å…¥ã€‚

### âœ” Manifest
- PWA icon å·²æ­£å¼æ›´æ›ç‚ºæ–°è§’è‰²åœ–ï¼ˆ192 / 512ï¼‰ã€‚
- å¼·åˆ¶ landscape æ¨¡å¼ä»¥ç¬¦åˆ iPad éŠæˆ²æƒ…å¢ƒã€‚

### ğŸ iOS / iPadOS PWA é«”é©—å„ªåŒ–
- åœ¨ `index.html` æ–°å¢ Apple PWA æ‰€éœ€è¨­å®šï¼š
  - `apple-touch-icon`
  - `apple-mobile-web-app-capable`
  - `apple-mobile-web-app-title`
- ä¿®æ­£ iPadã€ŒåŠ å…¥ä¸»ç•«é¢ã€å¾Œï¼š
  - icon ç¼ºå¤±å•é¡Œ
  - å•Ÿå‹•æ™‚å‡ºç¾ Safari ç™½ç•«é¢èˆ‡ `Response served by service worker has redirections` çš„éŒ¯èª¤ã€‚

é€™æ¬¡æ›´æ–°ä»£è¡¨ PWA æ¶æ§‹å·²ç¶“ã€Œæ­£å¼å¯é–‹å§‹åœ¨ iPad ä¸Šæ¸¬è©¦å®‰è£ & é›¢ç·šé‹ä½œã€ï¼Œå¾ŒçºŒå¯é€²å…¥å¯¦éš›éŠæˆ²æ¨¡çµ„èˆ‡ QA éšæ®µã€‚