# 動物指令大冒險 - 遊戲說明文件

## 遊戲概述

**動物指令大冒險**是一款程式邏輯教育遊戲，玩家需要控制小動物（兔子或恐龍）在網格地圖上移動，避開障礙物，到達目標位置。遊戲設計目的是培養兒童的邏輯思維、空間認知和問題解決能力。

## 遊戲類型

### 1. 📅 每日挑戰 (Daily Challenge)
- **特色**：每天固定的關卡配置（使用日期作為種子）
- **難度進程**：簡單 → 中等 → 困難（固定順序）
- **控制模式**：僅限模式 1（直接控制）
- **目標**：完成三個難度的關卡

### 2. 🎲 隨機闖關 (Normal Adventure)
- **特色**：每次遊戲都是隨機生成的關卡
- **難度進程**：簡單 → 中等 → 困難（固定順序）
- **控制模式**：僅限模式 1（直接控制）
- **目標**：完成三個難度的關卡

### 3. 🎮 自由練習 (Free Practice)
- **特色**：可自由選擇難度和控制模式
- **難度選擇**：簡單 / 中等 / 困難
- **控制模式**：模式 1 / 模式 2 / 模式 3
- **目標**：無限練習，隨時可以重置

## 控制模式

### 模式 1：直接控制
- **操作方式**：點擊按鈕直接控制小動物移動
- **可用指令**：
  - ⬆️ 前進 (Forward)
  - ⬅️ 左轉 (Turn Left)
  - ➡️ 右轉 (Turn Right)
  - 🦘 跳躍 (Jump)
- **特點**：
  - 即時反應，點擊後立即執行
  - 適合初學者
  - 可以隨時調整策略

### 模式 2：預排指令（連續）
- **操作方式**：預先排列一系列指令，然後執行
- **可用指令**：前進、左轉、右轉、跳躍
- **特點**：
  - 執行完畢後可以繼續添加新指令
  - 失敗不會重置位置
  - 適合學習序列思維
  - 可以分段規劃路徑

### 模式 3：預排指令（一次完成）
- **操作方式**：預先排列完整的指令序列
- **可用指令**：前進、左轉、右轉、跳躍
- **特點**：
  - 必須一次規劃完整路徑
  - 失敗會重置到起點
  - 最具挑戰性
  - 培養完整的邏輯規劃能力

## 難度等級

### 簡單 (Easy)
- **步數範圍**：3-6 步
- **障礙物**：1-3 個
- **湖泊**：0 個
- **跳躍需求**：0 次
- **路徑複雜度**：直線或簡單轉彎

### 中等 (Medium)
- **步數範圍**：5-10 步
- **障礙物**：2-5 個
- **湖泊**：0-2 個
- **跳躍需求**：0-1 次
- **路徑複雜度**：需要多次轉彎

### 困難 (Hard)
- **步數範圍**：8-15 步
- **障礙物**：3-7 個
- **湖泊**：1-3 個
- **跳躍需求**：1-2 次
- **路徑複雜度**：迷宮式路徑，需要規劃

## 遊戲元素

### 地圖元素
- **🐰 小兔子 / 🦖 恐龍**：玩家控制的角色
- **🎯 目標點**：需要到達的位置（紅旗）
- **🪨 障礙物**：可以跳過的石頭
- **💧 湖泊**：無法跳過，必須繞路

### 角色選擇
- **小兔子 (Rabbit)**：經典角色
- **恐龍 (Dino)**：替代角色

## 遊戲機制

### 移動規則
1. **前進**：朝當前方向移動一格
2. **左轉**：原地向左旋轉 90 度
3. **右轉**：原地向右旋轉 90 度
4. **跳躍**：跳過前方一格的障礙物，落在第二格

### 碰撞檢測
- **撞牆**：移動到地圖邊界外會失敗
- **撞石頭**：直接移動到障礙物會失敗（需要跳躍）
- **掉湖裡**：移動到湖泊會失敗
- **跳躍失敗**：跳躍目標位置有湖泊或障礙物會失敗

### 勝利條件
- 小動物到達目標位置（紅旗）

### 失敗處理
- **模式 1 & 2**：顯示碰撞動畫，可以繼續嘗試
- **模式 3**：重置到起點，清空所有指令

## 技術架構

### 核心組件

#### 1. 關卡生成系統
- **檔案**：`data/levels.ts`, `data/levelTemplates.ts`
- **功能**：
  - 基於模板和種子生成關卡
  - 確保關卡可解（路徑尋找算法）
  - 支援難度參數調整

#### 2. 指令系統
- **檔案**：`commands/` 目錄
- **架構**：Command Pattern（命令模式）
- **組件**：
  - `CommandRegistry.ts`：指令註冊中心
  - `forward.ts`：前進指令
  - `turnLeft.ts`：左轉指令
  - `turnRight.ts`：右轉指令
  - `jump.ts`：跳躍指令
  - `types.ts`：型別定義
  - `utils.ts`：工具函數

#### 3. 遊戲邏輯
- **檔案**：`hooks/useAnimalGame.ts`
- **功能**：
  - 遊戲狀態管理
  - 指令執行引擎
  - 碰撞檢測
  - 勝利/失敗判定

#### 4. UI 組件
- **檔案**：`components/` 目錄
- **組件**：
  - `GridMap.tsx`：網格地圖顯示
  - `DirectControlPanel.tsx`：直接控制面板（模式 1）
  - `CommandPalette.tsx`：指令選擇面板（模式 2/3）
  - `CommandSequence.tsx`：指令序列顯示
  - `ControlPanel.tsx`：執行控制面板

### 關卡生成算法

```typescript
// 使用種子隨機數生成器確保可重現性
class SeededRNG {
    // 基於種子生成確定性隨機數
    next(): number;
    range(min: number, max: number): number;
}

// 關卡生成流程
function generateLevel(mode: GameMode, difficulty: Difficulty, seed?: string) {
    1. 選擇難度模板
    2. 使用種子初始化 RNG
    3. 隨機選擇目標位置
    4. 生成障礙物和湖泊
    5. 驗證路徑可達性
    6. 返回關卡配置
}
```

### 音效系統

使用 `HTMLAudioElement` 實現音效播放：

```typescript
// 預加載音效
const walkAudio = new Audio('/audio/walk.mp3');
const turnAudio = new Audio('/audio/walk_turn.mp3');
const winAudio = new Audio('/audio/animal_game_win.mp3');
const hitAudio = new Audio('/audio/hit_sound.mp3');

// 播放音效
const playAudio = (audio: HTMLAudioElement, maxDuration: number) => {
    const sound = audio.cloneNode() as HTMLAudioElement;
    sound.play();
    // 自動清理
};
```

## 遊戲流程

### 1. 進入遊戲
1. 選擇遊戲類型（每日挑戰 / 隨機闖關 / 自由練習）
2. 選擇控制模式（模式 1 / 2 / 3）
3. 選擇難度（僅自由練習）
4. 選擇角色（兔子 / 恐龍）
5. 點擊「開始遊戲」

### 2. 遊戲中
- **模式 1**：點擊方向按鈕控制移動
- **模式 2/3**：
  1. 點擊指令按鈕添加到序列
  2. 點擊「執行」開始執行
  3. 觀察執行結果
  4. 根據需要調整策略

### 3. 完成關卡
- **自由練習**：顯示慶祝畫面，可選擇重玩或返回
- **闖關模式**：
  - 簡單 → 中等 → 困難
  - 完成三關後顯示勝利畫面

## 教育價值

### 培養能力
1. **邏輯思維**：規劃移動路徑
2. **空間認知**：理解方向和位置關係
3. **序列思維**：理解指令的順序執行
4. **問題解決**：面對障礙物尋找解決方案
5. **試錯學習**：從失敗中學習改進

### 難度漸進
- 從直接控制到預排指令
- 從簡單路徑到複雜迷宮
- 從無障礙到多重障礙

## 檔案結構

```
animal-commands/
├── AnimalEntry.tsx          # 遊戲入口頁面
├── AnimalGame.tsx           # 主遊戲組件
├── animal-commands.css      # 樣式表
├── commands/                # 指令系統
│   ├── CommandRegistry.ts
│   ├── forward.ts
│   ├── jump.ts
│   ├── turnLeft.ts
│   ├── turnRight.ts
│   ├── types.ts
│   └── utils.ts
├── components/              # UI 組件
│   ├── GridMap.tsx
│   ├── DirectControlPanel.tsx
│   ├── CommandPalette.tsx
│   ├── CommandSequence.tsx
│   └── ControlPanel.tsx
├── data/                    # 遊戲數據
│   ├── levels.ts           # 關卡配置
│   └── levelTemplates.ts   # 關卡模板
└── hooks/                   # React Hooks
    └── useAnimalGame.ts    # 遊戲邏輯
```

## 未來擴展

### 可能的功能
- [ ] 更多角色選擇
- [ ] 自定義關卡編輯器
- [ ] 多人對戰模式
- [ ] 成就系統
- [ ] 關卡分享功能
- [ ] 更多障礙物類型（傳送門、開關等）

### 技術優化
- [ ] 關卡生成算法優化
- [ ] 動畫效果增強
- [ ] 音效系統擴展
- [ ] 性能優化
